# API Portability Analyzer Guide

This guide will introduce you to the API Portability Analyzer tool (ApiPort for short) to help you port code from .NET Framework to .NET Core.  It is assumed that you have [already resolved any issues with 3rd party dependencies](overview.md).

There are two ways to use this tooling:

* [The command line](https://github.com/microsoft/dotnet-apiport/releases)
* [The Visual Studio Extension](https://visualstudiogallery.msdn.microsoft.com/1177943e-cfb7-4822-a8a6-e56c7905292b)

Both offer the same functionality.  Windows is a required OS.

ApiPort will analyze the assembly generated when you build a project.  So if you compile a class library in your solution and run the tool on the `.dll` generated, it will analyze the APIs used in that assembly.  You'll have to run the tool on each assembly that corresponds to a project you wish to port to .NET Core.

## How to use the tool (command line)

If you haven't already, [download the command line client](https://github.com/microsoft/dotnet-apiport/releases).  When unzipped, you'll get a few `.dll` files and the ApiPort executable.  You can run this executable from anywhere and it will generate a report in the directory it's run from.

Next, if you haven't already opened up your solution in Visual Studio, do so now and compile it.

For each of the Visual Studio projects you want to port to .NET Core, you'll need to do the following:

1. Copy the absolute path to the assembly generated by the build.

   a. Right Click Project -> Open Folder in File Explorer
   b. Open `\bin\Debug`
   c. Right click the address bar -> Copy address as text

2. Open a command line in the folder where the ApiPort tool is.
3. Execute the ApiPort following command for the assembly you just copied and the version of .NET Framework the assembly was compiled for.

   For example, if the assembly was compiled for .NET Framework 4.5.2, you would type this:

    PS> ApiPort.exe analyze -f path_of_assembly -t ".NET Core, Version=5.0" -t ".NET Framework, Version=4.5.2"
    
   This will generate an excel file containing the report.  You can also generate an HTML report by adding the `-r HTML` switch to command as such:
   
    PS> ApiPort.exe analyze -f path_of_assembly -t ".NET Core, Version=5.0" -t ".NET Framework, Version=4.5.2" -r HTML

Once you have all the reports you need, you can begin analyzing them!

## How to use the tool (Visual Studio)

TODO: need some screenshots here

## Understanding the generated report

When you compare .NET Framework assemblies for compatibility with .NET Core, the generated report will tell you a few things:

* Summary of assemblies with percentage of compatible APIs
* A breakdown of each assembly analyzed (your assembly and any it references)

The summary can be helpful at a first glance, but it can also be misleading.  For example, it may report that a particular assembly is only 50% compatible, but those incompatibilities may come from significant use of only a few APIs which have alternatives.

The breakdown of each assembly will likely take some time for you to digest.  Depending on the size of the assembly, it could be a huge list of things to analyze.  The general format of the table is this:

| Target Type | .NET implementations compared | Recommended Changes |

- **Target Type** - this is a .NET type that you've used that either is directly incompatible with .NET Core or has a child type that is incompatible.  This can include method calls as well.
- **.NET implementations compared** - this lists the .NET implementations you compared.  In this case, it will be .NET Core and .NET Framework.
- **Recommended Changes** - if there is a known recommended change for a particular type, it will be listed here.  If it is blank, then that means that the ApiPort service hasn't registered a recommended change for this type yet.

It's important to understand that just because a **Recommended Changes** field may be blank, that doesn't imply that there is no .NET Core alternative for an incompatible type!  This is where you'll need to exercize your own judgment and analyze the code itself to see what you were using that type for.  You may find that you don't need to use the type, or that there is an alternative available.  You may even find that you can write some code yourself to accomplish the same goal.

## Targets you can use for comparison

You can use ApiPort for more than just comparing .NET Framework and .NET Core targets.  For example, you may wish to compare a .NET Framework-based ASP.NET application to see how compatible the code is with ASP.NET Core.  Here's a table of targets the tool will recognize.

TODO: get a table in here